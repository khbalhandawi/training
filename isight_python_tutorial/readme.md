# Tutorial 1: Setting Up a Python Environment with venv and Creating a CLI Script

This tutorial will guide you through creating a Python virtual environment with venv, activating it, writing a Python script that accepts command-line arguments, and running the script from the command line.

## 1. Setting Up a Virtual Environment

### Step 1: Create the Virtual Environment

Open your terminal (or Command Prompt on Windows) and run:

For Linux/macOS:
> python3 -m venv .env

For Windows:
> python -m venv .env

This command creates a folder named `.env` containing an isolated Python environment.

### Step 2: Activate the Virtual Environment

For Linux/macOS:
> source .env/bin/activate

For Windows:
> .env\Scripts\activate

After activation, your terminal prompt will change to indicate you are now working inside the virtual environment.

## 2. Writing a Python Script with Command Line Arguments

Create a new file (e.g., `script_example.py`) and add the following code:

```python
import argparse

def calculate_equation(x1: float, x2: float):
    """
    Calculate the result of an equation using two input variables.
    Returns: a tuple of calculated values.
    """
    result_1 = (x1**2 + x2**2 + 2*x1*x2) / 2
    result_2 = (x1 + x2**3 + 5*x1*x2) / 2
    return result_1, result_2

if __name__ == "__main__":
    # Set up argument parser
    parser = argparse.ArgumentParser(description='Calculate equation with two variables')
    parser.add_argument('x1', type=float, help='First input variable')
    parser.add_argument('x2', type=float, help='Second input variable')
    parser.add_argument('--output', type=str, help='Output file path', default="output.txt")
    
    # Parse arguments
    args = parser.parse_args()
    
    # Calculate and print result
    outputs = calculate_equation(args.x1, args.x2)
    print(f"Result 1: {outputs[0]}, Result 2: {outputs[1]}")

    # Write results to the output file
    with open(args.output, "w") as f:
        f.write(f"{outputs[0]},{outputs[1]}")
```

This script uses the argparse module to accept the required positional arguments `x1` and `x2`, plus an optional `--output` argument for specifying the output file.

## 3. Running the Script from the Command Line

Assuming you are still inside your virtual environment:

1. Save the file as `script_example.py`.
2. Run the script using:

For Linux/macOS:
> python3 script_example.py 3.5 2.0 --output output.txt

For Windows:
> python script_example.py 3.5 2.0 --output output.txt

This command passes `3.5` and `2.0` as values for `x1` and `x2` respectively, and sets `output.txt` as the output file where the results are saved.

## 4. Deactivating the Virtual Environment

Once youâ€™re done, you can deactivate the virtual environment by simply running:
> deactivate

You have now set up a Python environment, written a script that utilizes command-line arguments, and executed the script from the shell.

# Tutorial 2: Interfacing the python script with Isight using 

This tutorial will explain how to use a custom python script as part of your Isight workflow. The corresponding isight file is called [python_script_tutorial.zmf](python_script_tutorial.zmf)

1. First insert the DOE process component into the workflow by right clicking the task and selecting `Change To > New`

    ![Task change](../images/isight_scripting/Task_change.png)

    * And then selecting `DOE` from the list of available components and clicking `Ok`

    ![insert DOE](../images/isight_scripting/DOE_insert.png)

    * Add two new parameters `x1` and `x2` corresponding to the two input variables defined in the previous python script. The should be set to output mode because they are generated by the DOE task during execution

    ![DOE parameters](../images/isight_scripting/DOE_params.png)

    * Add two new output parameters `f1` and `f2` corresponding to the two output variables defined in the previous python script. The should be set to input/output mode because they are input back to the DOE task during execution **and** will be used by the python script as outputs

    ![DOE output](../images/isight_scripting/DOE_output.png)

    * Be sure to select `x1` and `x2` as the factors to vary during the DOE

    ![doe factors](../images/isight_scripting/doe_factors.png)

2. Insert `Simcode` application component into the workflow and start by defining the `Command` tab

    ![Sim code](../images/isight_scripting/sim_code.png)

    and then configure `Simcode` as follows for the python script we developed in [the previous tutorial](#2-writing-a-python-script-with-command-line-arguments)

    * First select the python interpreter created as part of your virtual environment

    ![Select python](../images/isight_scripting/select_python.png)

    * Define the path to the script file. It must be relative to the `Model Directory` i.e., where the Isight file is stored

    ![Script File](../images/isight_scripting/script_file.png)
    ![script file add](../images/isight_scripting/script_file_add.png)

    * Add `x1` and `x2` as command line arguments

    ![Add x1](../images/isight_scripting/add_x1.png)

    * Add the `output_file` to the command line arguments `--output`

    ![Output Def](../images/isight_scripting/output_def.png)

    * Now the final command definition should look something like this

    ```bash
    C:\Users\Username\Desktop\ISIGHT_training\.env\Scripts\python.exe script_file x1 x2 --output output_file
    ```

    ![final command](../images/isight_scripting/final_command.png)

    * Force `Simcode` to wait for the `output.txt` file by navigating to the `advanced` tab and selecting the following options

    ![wait output](../images/isight_scripting/wait_output.png)

3. Now we need to define the `Output` tab of the `Simcode` component as follows

    * Define the output formatting by clicking on the below dialog

    ![output def](../images/isight_scripting/output_in.png)

    * Next, browse to the `output.txt` file and select `Vector` because the output of our python file is delimited by a comma

    ![tagging f1](../images/isight_scripting/tagging_f1.png)

    * Repeat the same thing with `f2`

    ![tagging f2](../images/isight_scripting/tagging_f2.png)

    * Make sure the `output.txt` file is being read from the `{modeldir}` where the Isight model is saved by following these instructions

    ![output modeldir](../images/isight_scripting/output_modeldir.png)

4. Executing the DOE with a python script

    * Make sure the variable mappings are defined as shown below to ensure that `x1` and `x2` are being fed into `Simcode` and `f1` and `f2` are being output back to the DOE task

    ![data flow](../images/isight_scripting/data_flow.png)

    * You may now execute the DOE task by Right clicking the `DOE1` and clicking `Run > Run Component (DOE1)`

    ![DOE complete](../images/isight_scripting/DOE_complete.png)